{% extends "base.html" %}
{% load static %}

{% block title %}Reset Password{% endblock %}

{% block content %}
<div class="max-w-md mx-auto mt-8">
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            {% if validlink %}
                <h1 class="card-title text-2xl mb-2">Set New Password</h1>
                <p class="text-sm opacity-70 mb-4">Please enter your new password twice.</p>

                <form method="post" novalidate>
                    {% csrf_token %}

                    <label class="form-control w-full mb-3">
                        <div class="label">
                            <span class="label-text">New Password</span>
                        </div>
                        <input type="password" name="{{ form.new_password1.html_name }}"
                            class="input input-bordered w-full" required autofocus />
                        {% if form.new_password1.errors %}
                        <div class="text-error text-sm mt-1">{{ form.new_password1.errors.0 }}</div>
                        {% endif %}
                    </label>

                    <label class="form-control w-full mb-4">
                        <div class="label">
                            <span class="label-text">Confirm New Password</span>
                        </div>
                        <input type="password" name="{{ form.new_password2.html_name }}"
                            class="input input-bordered w-full" required />
                        {% if form.new_password2.errors %}
                        <div class="text-error text-sm mt-1">{{ form.new_password2.errors.0 }}</div>
                        {% endif %}
                    </label>

                    {% if form.non_field_errors %}
                    <div class="alert alert-error mb-3">
                        <span>{{ form.non_field_errors.0 }}</span>
                    </div>
                    {% endif %}

                    <button class="btn btn-primary w-full" type="submit">Change Password</button>
                </form>
            {% else %}
                <h1 class="card-title text-2xl mb-2">Password Reset Failed</h1>
                <div class="alert alert-error mb-4">
                    <span>The password reset link was invalid, possibly because it has already been used. Please request a new password reset.</span>
                </div>
                <div class="text-center">
                    <a class="btn btn-primary" href="{% url 'accounts:password_reset' %}">Request New Reset</a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}