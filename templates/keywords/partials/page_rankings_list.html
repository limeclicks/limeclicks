<!-- Update metrics and page state -->
<script>
    document.getElementById('totalPages').textContent = '{{ total_pages }}';
    document.getElementById('totalKeywords').textContent = '{{ total_keywords }}';
    document.getElementById('avgPosition').textContent = '{{ avg_position }}';
</script>

{% if pages %}
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Page
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Keywords
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Avg Position
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Best Performing Keyword
                        </th>
                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Actions
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for page in pages %}
                    <tr class="hover:bg-gray-50 transition-colors duration-150">
                        <td class="px-6 py-4">
                            <div>
                                <div class="text-sm font-medium text-gray-900">{{ page.page_title }}</div>
                                <a href="{{ page.url }}" target="_blank" 
                                   class="text-sm text-blue-600 hover:text-blue-800 hover:underline">
                                    {{ page.url|truncatechars:60 }}
                                </a>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                {{ page.total_keywords }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                #{{ page.avg_position }}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            {% if page.best_keyword %}
                            <div class="text-sm text-gray-900">
                                <span class="font-medium">{{ page.best_keyword|truncatechars:40 }}</span>
                                <span class="text-gray-500">(#{{ page.best_position }})</span>
                            </div>
                            {% else %}
                            <span class="text-sm text-gray-400">-</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 text-center whitespace-nowrap">
                            <button class="btn btn-sm btn-primary"
                                    hx-get="{% url 'keywords:page_keywords_detail' %}?url={{ page.url|urlencode }}&project_id={{ page.project_id }}"
                                    hx-target="#modalBody"
                                    hx-trigger="click"
                                    hx-swap="innerHTML settle:100ms">
                                <i class="fas fa-eye mr-1"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Pagination -->
    {% if pagination.total_pages > 1 %}
    <div class="mt-6 bg-white px-4 py-3 border border-gray-200 rounded-lg sm:px-6">
        <div class="flex items-center justify-between">
            <div class="flex-1 flex justify-between sm:hidden">
                {% if pagination.has_previous %}
                <button class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
                        hx-get="{% url 'keywords:page_rankings_data' %}?page={{ pagination.previous_page }}&search={{ request.GET.search|default:'' }}&project={{ request.GET.project|default:'' }}&per_page={{ request.GET.per_page|default:'50' }}"
                        hx-target="#pagesContainer"
                        hx-indicator="#loadingIndicator">
                    Previous
                </button>
                {% endif %}
                {% if pagination.has_next %}
                <button class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
                        hx-get="{% url 'keywords:page_rankings_data' %}?page={{ pagination.next_page }}&search={{ request.GET.search|default:'' }}&project={{ request.GET.project|default:'' }}&per_page={{ request.GET.per_page|default:'50' }}"
                        hx-target="#pagesContainer"
                        hx-indicator="#loadingIndicator">
                    Next
                </button>
                {% endif %}
            </div>
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700">
                        Showing page <span class="font-medium">{{ pagination.current_page }}</span> of 
                        <span class="font-medium">{{ pagination.total_pages }}</span>
                        <span class="text-gray-500">(<span class="font-medium">{{ pagination.total_items }}</span> total pages)</span>
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        {% if pagination.has_previous %}
                        <button class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                                hx-get="{% url 'keywords:page_rankings_data' %}?page={{ pagination.previous_page }}&search={{ request.GET.search|default:'' }}&project={{ request.GET.project|default:'' }}&per_page={{ request.GET.per_page|default:'50' }}"
                                hx-target="#pagesContainer"
                                hx-indicator="#loadingIndicator">
                            <span class="sr-only">Previous</span>
                            <i class="fas fa-chevron-left text-xs"></i>
                        </button>
                        {% else %}
                        <button class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400 cursor-not-allowed" disabled>
                            <span class="sr-only">Previous</span>
                            <i class="fas fa-chevron-left text-xs"></i>
                        </button>
                        {% endif %}
                        
                        {% for page_num in pagination.page_range %}
                            {% if page_num == '...' %}
                            <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                                ...
                            </span>
                            {% elif page_num == pagination.current_page %}
                            <span class="z-10 relative inline-flex items-center px-4 py-2 border border-blue-500 bg-blue-50 text-sm font-medium text-blue-600">
                                {{ page_num }}
                            </span>
                            {% else %}
                            <button class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"
                                    hx-get="{% url 'keywords:page_rankings_data' %}?page={{ page_num }}&search={{ request.GET.search|default:'' }}&project={{ request.GET.project|default:'' }}&per_page={{ request.GET.per_page|default:'50' }}"
                                    hx-target="#pagesContainer"
                                    hx-indicator="#loadingIndicator">
                                {{ page_num }}
                            </button>
                            {% endif %}
                        {% endfor %}
                        
                        {% if pagination.has_next %}
                        <button class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                                hx-get="{% url 'keywords:page_rankings_data' %}?page={{ pagination.next_page }}&search={{ request.GET.search|default:'' }}&project={{ request.GET.project|default:'' }}&per_page={{ request.GET.per_page|default:'50' }}"
                                hx-target="#pagesContainer"
                                hx-indicator="#loadingIndicator">
                            <span class="sr-only">Next</span>
                            <i class="fas fa-chevron-right text-xs"></i>
                        </button>
                        {% else %}
                        <button class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400 cursor-not-allowed" disabled>
                            <span class="sr-only">Next</span>
                            <i class="fas fa-chevron-right text-xs"></i>
                        </button>
                        {% endif %}
                    </nav>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
{% else %}
    <div class="empty-state">
        <div class="empty-state-icon">📊</div>
        <h3>No Pages Found</h3>
        <p>No pages are currently ranking for keywords in the selected filters.</p>
    </div>
{% endif %}