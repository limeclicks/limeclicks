{% for keyword in keywords %}
<tr class="keyword-row">
    <td>
        <div class="font-medium">{{ keyword.keyword }}</div>
        {% if keyword.rank_url %}
        <div class="mt-1">
            <a href="{{ keyword.rank_url }}" target="_blank" class="text-xs text-base-content/60 hover:text-primary hover:underline block truncate max-w-xs" title="{{ keyword.rank_url }}">
                <i class="fas fa-link text-[10px] mr-1"></i>{{ keyword.rank_url|truncatechars:50 }}
            </a>
        </div>
        {% endif %}
        {% if keyword.keyword_tags.all %}
        <div class="flex flex-wrap gap-1 mt-1">
            {% for keyword_tag in keyword.keyword_tags.all %}
            <span class="badge badge-sm" style="background-color: {{ keyword_tag.tag.color }}; color: white;">
                {{ keyword_tag.tag.name }}
            </span>
            {% endfor %}
        </div>
        {% endif %}
    </td>
    <td class="text-center">
        {% if keyword.rank > 0 and keyword.rank <= 100 %}
            <span class="badge rank-badge 
                {% if keyword.rank == 1 %}rank-1{% elif keyword.rank == 2 %}rank-2{% elif keyword.rank == 3 %}rank-3{% elif keyword.rank <= 10 %}rank-top10{% elif keyword.rank <= 30 %}rank-top30{% elif keyword.rank <= 50 %}rank-top50{% else %}rank-top100{% endif %}">
                #{{ keyword.rank }}
            </span>
        {% else %}
            <span class="badge rank-badge rank-none">NR</span>
        {% endif %}
    </td>
    <td class="text-center">
        {% if keyword.rank_diff_from_last_time != 0 %}
            <span class="flex items-center justify-center gap-1">
                {% if keyword.rank_diff_from_last_time > 0 %}
                    <i class="fas fa-arrow-up text-xs rank-change-up"></i>
                    <span class="text-sm font-semibold rank-change-up">+{{ keyword.rank_diff_from_last_time }}</span>
                {% else %}
                    <i class="fas fa-arrow-down text-xs rank-change-down"></i>
                    <span class="text-sm font-semibold rank-change-down">{{ keyword.rank_diff_from_last_time }}</span>
                {% endif %}
            </span>
        {% else %}
            <span class="text-base-content/40">-</span>
        {% endif %}
    </td>
    <td>
        <span class="badge badge-ghost">{{ keyword.country }}</span>
    </td>
    <td>
        {% if keyword.scraped_at %}
            <span class="text-sm">{{ keyword.scraped_at|timesince }} ago</span>
        {% else %}
            <span class="text-sm text-base-content/40">Never</span>
        {% endif %}
    </td>
    <td class="text-right">
        <div class="dropdown dropdown-end">
            <button tabindex="0" class="btn btn-ghost btn-sm">
                <i class="fas fa-ellipsis-v"></i>
            </button>
            <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52 border">
                <li>
                    <button 
                        hx-post="{% url 'keywords:api_force_crawl' keyword.id %}"
                        hx-trigger="click"
                        hx-swap="none"
                        hx-confirm="Force crawl this keyword now?"
                    >
                        <i class="fas fa-sync"></i>
                        Force Crawl
                    </button>
                </li>
                <li>
                    <a href="#" class="text-error">
                        <i class="fas fa-trash"></i>
                        Delete
                    </a>
                </li>
            </ul>
        </div>
    </td>
</tr>
{% endfor %}