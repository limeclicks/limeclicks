{% load audit_filters %}
<!-- Issue items with modern fix suggestions -->
{% for issue in issues %}
<div class="card bg-base-100 shadow-sm border border-base-300 hover:shadow-lg transition-all duration-200 group">
    <div class="card-body p-5">
        <!-- Issue Header with Severity -->
        <div class="flex items-start gap-4">
            <!-- Severity Indicator -->
            <div class="flex-shrink-0">
                {% if issue.severity == "critical" %}
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-700 to-red-800 flex items-center justify-center shadow-lg shadow-red-700/20">
                    <i class="fas fa-exclamation-circle text-white text-lg"></i>
                </div>
                {% elif issue.severity == "high" %}
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-400 to-red-500 flex items-center justify-center shadow-lg shadow-red-400/20">
                    <i class="fas fa-exclamation-triangle text-white text-lg"></i>
                </div>
                {% elif issue.severity == "medium" %}
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-yellow-500 to-yellow-400 flex items-center justify-center shadow-lg shadow-yellow-500/20">
                    <i class="fas fa-exclamation text-white text-lg"></i>
                </div>
                {% elif issue.severity == "low" %}
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-400 flex items-center justify-center shadow-lg shadow-blue-500/20">
                    <i class="fas fa-info-circle text-white text-lg"></i>
                </div>
                {% else %}
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-base-300 to-base-300/80 flex items-center justify-center">
                    <i class="fas fa-info text-base-content/60 text-lg"></i>
                </div>
                {% endif %}
            </div>
            
            <!-- Issue Content -->
            <div class="flex-1 space-y-3">
                <!-- Title and Badges -->
                <div>
                    <h3 class="text-lg font-semibold text-base-content mb-2">
                        {{ issue|get_fix_title }}
                    </h3>
                    
                    <div class="flex flex-wrap items-center gap-2">
                        <!-- Severity Badge -->
                        {% if issue.severity == "critical" %}
                        <span class="badge gap-1" style="background-color: #b91c1c; color: white;">
                            <i class="fas fa-fire text-xs"></i> Critical
                        </span>
                        {% elif issue.severity == "high" %}
                        <span class="badge gap-1" style="background-color: #f87171; color: white;">
                            <i class="fas fa-exclamation text-xs"></i> High Priority
                        </span>
                        {% elif issue.severity == "medium" %}
                        <span class="badge gap-1" style="background-color: #eab308; color: white;">
                            <i class="fas fa-flag text-xs"></i> Medium
                        </span>
                        {% elif issue.severity == "low" %}
                        <span class="badge badge-info gap-1">
                            <i class="fas fa-info-circle text-xs"></i> Low
                        </span>
                        {% else %}
                        <span class="badge badge-ghost gap-1">Info</span>
                        {% endif %}
                        
                        <!-- Category Badge -->
                        <span class="badge badge-outline badge-sm">
                            <i class="fas fa-tag text-xs mr-1"></i>
                            {{ issue.issue_category|replace_underscore }}
                        </span>
                        
                        <!-- Status Badge -->
                        {% if issue.status == 'new' %}
                        <span class="badge badge-success badge-sm gap-1">
                            <span class="relative flex h-2 w-2">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-success opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-2 w-2 bg-success"></span>
                            </span>
                            New
                        </span>
                        {% elif issue.status == 'persisting' %}
                        <span class="badge badge-warning badge-sm gap-1">
                            <i class="fas fa-sync-alt text-xs"></i> Persisting
                        </span>
                        {% elif issue.status == 'resolved' %}
                        <span class="badge badge-info badge-sm gap-1">
                            <i class="fas fa-check-circle text-xs"></i> Resolved
                        </span>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Issue Description -->
                <div class="bg-base-200/30 rounded-lg p-3 border border-base-300/50">
                    <p class="text-sm text-base-content/80 leading-relaxed">
                        {{ issue|get_fix_description }}
                    </p>
                </div>
                
                <!-- Affected URL -->
                {% if issue.url %}
                <div class="flex items-center gap-2 p-2 bg-base-200/20 rounded-lg">
                    <i class="fas fa-link text-base-content/50 text-sm"></i>
                    <a href="{{ issue.url }}" target="_blank" 
                       class="text-sm text-primary hover:text-primary-focus transition-colors truncate flex-1 font-mono">
                        {{ issue.url|truncatechars:80 }}
                    </a>
                    <button onclick="navigator.clipboard.writeText('{{ issue.url }}')" 
                            class="btn btn-ghost btn-xs opacity-0 group-hover:opacity-100 transition-opacity">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                {% endif %}
                
                <!-- Fix Suggestions (Collapsible) -->
                <div class="collapse collapse-arrow bg-gradient-to-r from-base-200/20 to-base-200/10 rounded-lg border border-base-300/30">
                    <input type="checkbox" class="peer" />
                    <div class="collapse-title font-medium flex items-center gap-2 py-3">
                        <i class="fas fa-tools text-primary"></i>
                        <span>How to Fix This Issue</span>
                        <span class="ml-auto text-xs text-base-content/60">Click to expand</span>
                    </div>
                    <div class="collapse-content">
                        <div class="space-y-3 pt-2">
                            <!-- Fix Steps -->
                            <div class="space-y-2">
                                <h4 class="text-sm font-semibold text-base-content/90 flex items-center gap-2">
                                    <i class="fas fa-list-check text-success"></i>
                                    Recommended Actions:
                                </h4>
                                <ol class="space-y-2 ml-6">
                                    {% for step in issue|get_fix_steps %}
                                    <li class="text-sm text-base-content/70 flex items-start gap-2">
                                        <span class="text-primary font-semibold mt-0.5">{{ forloop.counter }}.</span>
                                        <span>{{ step }}</span>
                                    </li>
                                    {% endfor %}
                                </ol>
                            </div>
                            
                            <!-- Impact -->
                            <div class="alert alert-info py-2">
                                <i class="fas fa-info-circle text-info"></i>
                                <div>
                                    <h4 class="text-sm font-semibold">Impact</h4>
                                    <p class="text-xs">{{ issue|get_fix_impact }}</p>
                                </div>
                            </div>
                            
                            <!-- Technical Details (if any) -->
                            {% if issue.issue_data and issue.issue_data.status_code %}
                            <div class="bg-base-300/30 rounded-lg p-3">
                                <h4 class="text-xs font-semibold text-base-content/60 mb-2">Technical Details:</h4>
                                <div class="grid grid-cols-2 gap-2 text-xs">
                                    {% if issue.issue_data.status_code %}
                                    <div>
                                        <span class="text-base-content/50">Status:</span>
                                        <span class="ml-1 font-mono">{{ issue.issue_data.status_code }} {{ issue.issue_data.status_text }}</span>
                                    </div>
                                    {% endif %}
                                    {% if issue.issue_data.response_time %}
                                    <div>
                                        <span class="text-base-content/50">Response Time:</span>
                                        <span class="ml-1 font-mono">{{ issue.issue_data.response_time }}ms</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endfor %}

{% if not issues %}
<div class="card bg-base-100 border-2 border-dashed border-base-300">
    <div class="card-body text-center py-12">
        <i class="fas fa-check-circle text-6xl text-success mb-4"></i>
        <h3 class="text-xl font-semibold text-base-content">No Issues Found</h3>
        <p class="text-base-content/60">Great! Your site appears to be in good shape.</p>
    </div>
</div>
{% endif %}