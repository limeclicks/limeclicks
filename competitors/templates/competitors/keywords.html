{% extends "dashboard_base.html" %}
{% load static %}

{% block title %}Competitor Keywords - LimeClicks{% endblock %}
{% block page_title %}Competitor Keywords{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header with Filters -->
    <div class="bg-base-100 rounded-lg shadow-sm border border-base-300 p-6 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Search Input -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text">Search Keywords</span>
                </label>
                <div class="relative">
                    <input type="text" 
                           name="search"
                           placeholder="Search keywords..." 
                           class="input input-bordered w-full pr-10"
                           hx-get="{% url 'competitors:keywords-table' %}"
                           hx-trigger="keyup changed delay:500ms, search"
                           hx-target="#keywords-table"
                           hx-include="[name='project'], [name='per_page']" />
                    <button class="btn btn-ghost btn-sm absolute right-1 top-1/2 -translate-y-1/2">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            <!-- Project Filter -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text">Filter by Project</span>
                </label>
                <select name="project" 
                        class="select select-bordered w-full"
                        hx-get="{% url 'competitors:keywords-table' %}"
                        hx-trigger="change"
                        hx-target="#keywords-table"
                        hx-include="[name='search'], [name='per_page']">
                    <option value="">All Projects</option>
                    {% for project in projects %}
                        <option value="{{ project.id }}" {% if selected_project_id == project.id|stringformat:"s" %}selected{% endif %}>
                            {{ project.domain }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Items Per Page -->
            <div class="form-control">
                <label class="label">
                    <span class="label-text">Items Per Page</span>
                </label>
                <select name="per_page" 
                        class="select select-bordered w-full"
                        hx-get="{% url 'competitors:keywords-table' %}"
                        hx-trigger="change"
                        hx-target="#keywords-table"
                        hx-include="[name='search'], [name='project']">
                    <option value="25">25</option>
                    <option value="50" selected>50</option>
                    <option value="100">100</option>
                    <option value="200">200</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- Keywords Table Container -->
    <div id="keywords-table" 
         hx-get="{% url 'competitors:keywords-table' %}"
         hx-trigger="load"
         hx-include="[name='search'], [name='project'], [name='per_page']">
        <div class="bg-base-100 rounded-lg shadow-sm border border-base-300">
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <thead>
                        <tr>
                            <th class="min-w-[200px]">Keyword</th>
                            <th>Project</th>
                            <th class="text-center">Your Rank</th>
                            <th class="text-center">#1</th>
                            <th class="text-center">#2</th>
                            <th class="text-center">#3</th>
                            <th>Country</th>
                            <th>Last Scraped</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="8" class="text-center py-8">
                                <div class="loading loading-spinner loading-lg"></div>
                                <p class="mt-2">Loading keywords...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% endblock %}