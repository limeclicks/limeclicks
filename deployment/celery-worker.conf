# Celery worker configuration for production deployment
# This configuration helps prevent database connection exhaustion

# Worker pool settings
--pool=prefork
--concurrency=4
--max-tasks-per-child=100
--max-memory-per-child=512000

# Task settings  
--time-limit=300
--soft-time-limit=240

# Optimization settings
--without-gossip
--without-mingle
--without-heartbeat
--prefetch-multiplier=1

# Queue configuration
--queues=celery,default,serp_high,serp_default,accounts

# Logging
--loglevel=info
--logfile=/var/log/celery/worker.log

# Important: These settings help prevent database connection issues:
# - max-tasks-per-child=100: Restarts workers after 100 tasks to release DB connections
# - prefetch-multiplier=1: Prevents workers from holding too many tasks
# - concurrency=4: Limits concurrent workers to prevent too many DB connections